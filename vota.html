<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vota√ß√£o - Concurso Fotogr√°fico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gapi/2.0.0/gapi.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .login-section {
            background: white;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .voting-interface {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .photo-card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .photo-info {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            align-items: start;
        }

        .photo-details h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .photo-details p {
            margin-bottom: 8px;
            color: #555;
        }

        .photo-container {
            text-align: center;
        }

        .photo-container img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .photo-container img:hover {
            transform: scale(1.02);
        }

        .rating-section {
            margin-top: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .rating-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .rating-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .rating-btn {
            width: 60px;
            height: 60px;
            border: 3px solid #ddd;
            background: white;
            border-radius: 50%;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rating-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .rating-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: scale(1.1);
        }

        .save-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: transform 0.2s ease;
        }

        .save-btn:hover {
            transform: translateY(-2px);
        }

        .save-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .nav-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: #5a6fd8;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .summary {
            background: #e8f5e8;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }

        .login-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s ease;
        }

        .login-btn:hover {
            background: #3367d6;
        }

        .user-info {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            margin-top: 5%;
        }

        .save-status.info {
            background: #2196F3;
            color: white;
        }

        .save-status.success {
            background: #4CAF50;
            color: white;
        }

        .save-status.error {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .photo-info {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .rating-buttons {
                gap: 10px;
            }
            
            .rating-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Concurso Fotogr√°fico</h1>
            <p>Sistema de Vota√ß√£o para Jurados</p>
        </div>

        <!-- Se√ß√£o de Login -->
        <div id="loginSection" class="login-section">
            <h2>Acesso para Jurados</h2>
            <p style="margin: 20px 0;">Entre com sua conta Google para come√ßar a vota√ß√£o</p>
            <button id="loginBtn" class="login-btn">
                <span>üìß</span>
                Entrar com Google
            </button>
        </div>

        <!-- Interface de Vota√ß√£o -->
        <div id="votingInterface" class="voting-interface">
            <div id="userInfo" class="user-info"></div>
            
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%"></div>
            </div>
            
            <div id="photoCard" class="photo-card">
                <!-- Conte√∫do da foto ser√° inserido aqui -->
            </div>
            
            <div class="navigation">
                <button id="prevBtn" class="nav-btn">‚Üê Anterior</button>
                <span id="photoCounter">1 / 200</span>
                <button id="nextBtn" class="nav-btn">Pr√≥xima ‚Üí</button>
            </div>
            
            <div id="summary" class="summary" style="display: none;">
                <h3>üéâ Vota√ß√£o Conclu√≠da!</h3>
                <p>Obrigado por participar da avalia√ß√£o!</p>
                <div id="summaryStats"></div>
            </div>
        </div>
    </div>

    <!-- Modal para ampliar foto -->
    <div id="photoModal" class="modal">
        <img id="modalImage" class="modal-content">
    </div>

    <script>
        // Configura√ß√µes do Google Sheets API
        const SHEET_ID = '1kBTwVXA1-uMt0Doh0fHqdVzuv4qnEbasxn3Ke0mxiow';
        const CLIENT_ID = '79879110934-bco496812b08vkorealkith5a5hi2ia2.apps.googleusercontent.com';
        const API_KEY = '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';
        const DISCOVERY_DOCS = ['https://sheets.googleapis.com/$discovery/rest?version=v4'];
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.readonly';

        // Estado da aplica√ß√£o
        let currentUser = null;
        let photos = [];
        let currentPhotoIndex = 0;
        let votes = {};
        let gapiInitialized = false;

        // Configura√ß√£o dos jurados autorizados
        const JURADOS_AUTORIZADOS = {
            'kacauoliveirafotos@gmail.com': { coluna: 'F', nome: 'Jurado 1' },
            'avistarconecta@gmail.com': { coluna: 'G', nome: 'Jurado 2' },
            'projetos.turismo@ilhabela.sp.gov.br': { coluna: 'H', nome: 'Jurado 3' },
            'zeedoo@gmail.com': { coluna: 'I', nome: 'Jurado 4' }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Aguardar carregamento da API do Google
            if (typeof gapi !== 'undefined') {
                gapi.load('client:auth2', initializeGapi);
            } else {
                console.log('GAPI n√£o carregou, tentando novamente...');
                setTimeout(() => {
                    if (typeof gapi !== 'undefined') {
                        gapi.load('client:auth2', initializeGapi);
                    } else {
                        showDebugInfo();
                    }
                }, 2000);
            }
        });

        async function initializeGapi() {
            try {
                console.log('Inicializando Google API...');
                
                await gapi.client.init({
                    apiKey: API_KEY,
                    clientId: CLIENT_ID,
                    discoveryDocs: DISCOVERY_DOCS,
                    scope: SCOPES
                });
                
                gapiInitialized = true;
                console.log('‚úÖ Google API inicializada com sucesso');
                
                // Atualizar interface para mostrar que est√° pronto
                updateLoginButton('Pronto para login!');
                
                // Verificar se j√° est√° logado
                const authInstance = gapi.auth2.getAuthInstance();
                if (authInstance.isSignedIn.get()) {
                    console.log('Usu√°rio j√° logado, carregando dados...');
                    handleAuthSuccess();
                }
            } catch (error) {
                console.error('‚ùå Erro ao inicializar Google API:', error);
                gapiInitialized = false;
                
                // Mostrar modo demo para testar interface
                updateLoginButton('Erro na API - Modo Demo');
                document.getElementById('loginBtn').onclick = startDemoMode;
            }
        }

        function updateLoginButton(text) {
            const btn = document.getElementById('loginBtn');
            if (btn) {
                btn.innerHTML = `<span>üìß</span> ${text}`;
            }
        }

        function startDemoMode() {
            alert('Modo demonstra√ß√£o - usando dados de exemplo');
            
            // Simular usu√°rio logado para teste
            currentUser = {
                name: "Teste Jurado",
                email: "kacauoliveirafotos@gmail.com",
                juradoInfo: JURADOS_AUTORIZADOS['kacauoliveirafotos@gmail.com']
            };
            
            loadDemoData();
            showVotingInterface();
        }

        function showDebugInfo() {
            document.getElementById('loginSection').innerHTML = `
                <h2>üîß Debug - Sistema de Vota√ß√£o</h2>
                <div style="text-align: left; background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <p><strong>Status da API Google:</strong> ${typeof gapi !== 'undefined' ? '‚úÖ Carregada' : '‚ùå N√£o carregada'}</p>
                    <p><strong>GAPI Inicializada:</strong> ${gapiInitialized ? '‚úÖ Sim' : '‚ùå N√£o'}</p>
                    <p><strong>Dom√≠nio atual:</strong> ${window.location.origin}</p>
                    <p><strong>Planilha ID:</strong> ${SHEET_ID}</p>
                </div>
                
                <button onclick="startDemoMode()" class="login-btn" style="background: #orange;">
                    üß™ Testar Interface (Modo Demo)
                </button>
                
                <button onclick="location.reload()" class="login-btn" style="background: #666; margin-top: 10px;">
                    üîÑ Recarregar P√°gina
                </button>
                
                <div style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                    <p><strong>Poss√≠veis solu√ß√µes:</strong></p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li>Verificar se dom√≠nio est√° autorizado no Google Cloud Console</li>
                        <li>Aguardar alguns minutos para propaga√ß√£o das configura√ß√µes</li>
                        <li>Testar em aba an√¥nima</li>
                        <li>Verificar console do navegador (F12)</li>
                    </ul>
                </div>
            `;
        }

        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('prevBtn').addEventListener('click', () => navigatePhoto(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigatePhoto(1));
            
            // Modal para ampliar fotos
            document.getElementById('photoModal').addEventListener('click', closeModal);
        }

        function handleLogin() {
            if (!gapiInitialized) {
                alert('Sistema ainda carregando. Tente novamente em alguns segundos.');
                return;
            }
            
            const authInstance = gapi.auth2.getAuthInstance();
            authInstance.signIn().then(handleAuthSuccess).catch(error => {
                console.error('Erro no login:', error);
                alert('Erro ao fazer login. Verifique suas permiss√µes.');
            });
        }

        function handleAuthSuccess() {
            const authInstance = gapi.auth2.getAuthInstance();
            const user = authInstance.currentUser.get();
            const profile = user.getBasicProfile();
            const email = profile.getEmail();
            
            // Verificar se √© jurado autorizado
            if (!JURADOS_AUTORIZADOS[email]) {
                alert('Acesso negado. Voc√™ n√£o est√° autorizado como jurado.');
                authInstance.signOut();
                return;
            }
            
            currentUser = {
                name: profile.getName(),
                email: email,
                juradoInfo: JURADOS_AUTORIZADOS[email]
            };
            
            loadPhotosFromSheets();
        }

        async function loadPhotosFromSheets() {
            try {
                showLoading('Carregando fotos do concurso...');
                
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SHEET_ID,
                    range: 'Fotos_Votacao!A2:J200', // Ajuste conforme necess√°rio
                });
                
                const rows = response.result.values || [];
                photos = rows
                    .filter(row => row[0] && row[4]) // Tem ID e link
                    .map(row => ({
                        id: row[0],
                        participante: row[1] || 'N/A',
                        titulo: row[2] || 'Sem t√≠tulo',
                        especie: row[3] || 'N/A',
                        link: convertDriveLink(row[4]),
                        votos: {
                            jurado1: row[5] || '',
                            jurado2: row[6] || '',
                            jurado3: row[7] || '',
                            jurado4: row[8] || ''
                        }
                    }));
                
                // Carregar votos j√° existentes do jurado atual
                loadExistingVotes();
                
                hideLoading();
                showVotingInterface();
                
            } catch (error) {
                console.error('Erro ao carregar fotos:', error);
                hideLoading();
                alert('Erro ao carregar fotos. Verifique as permiss√µes da planilha.');
            }
        }

        function loadExistingVotes() {
            const juradoCol = currentUser.juradoInfo.coluna;
            const colIndex = juradoCol.charCodeAt(0) - 70; // F=0, G=1, H=2, I=3
            
            photos.forEach(photo => {
                const votoExistente = Object.values(photo.votos)[colIndex];
                if (votoExistente && !isNaN(votoExistente)) {
                    votes[photo.id] = parseInt(votoExistente);
                }
            });
        }

        function showLoading(message) {
            document.getElementById('loginSection').innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 20px;">‚è≥</div>
                    <p>${message}</p>
                </div>
            `;
        }

        function hideLoading() {
            document.getElementById('loginSection').style.display = 'none';
        }

        function showVotingInterface() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('votingInterface').style.display = 'block';
            
            // Mostrar info do usu√°rio
            document.getElementById('userInfo').innerHTML = `
                <strong>Logado como:</strong> ${currentUser.name} (${currentUser.email})
                <button onclick="logout()" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">Sair</button>
            `;
            
            loadCurrentPhoto();
        }

        function showVotingInterface() {
            document.getElementById('votingInterface').style.display = 'block';
            
            // Mostrar info do usu√°rio
            document.getElementById('userInfo').innerHTML = `
                <strong>Logado como:</strong> ${currentUser.name} (${currentUser.email})
                <span style="margin-left: 20px; color: #666;">${currentUser.juradoInfo.nome}</span>
                <button onclick="logout()" style="float: right; background: #dc3545; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">Sair</button>
            `;
            
            loadCurrentPhoto();
        }

        function loadCurrentPhoto() {
            if (photos.length === 0) {
                document.getElementById('photoCard').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>Nenhuma foto encontrada</h3>
                        <p>Verifique se a planilha cont√©m dados na aba 'Fotos_Votacao'</p>
                    </div>
                `;
                return;
            }
            
            const photo = photos[currentPhotoIndex];
            const currentVote = votes[photo.id] || 0;
            
            document.getElementById('photoCard').innerHTML = `
                <div class="photo-info">
                    <div class="photo-details">
                        <h3>${photo.titulo}</h3>
                        <p><strong>Participante:</strong> ${photo.participante}</p>
                        <p><strong>Esp√©cie:</strong> ${photo.especie}</p>
                        <p><strong>ID:</strong> ${photo.id}</p>
                        
                        <div class="rating-section">
                            <div class="rating-title">Avalie esta foto (1 a 5)</div>
                            <div class="rating-buttons">
                                ${[1,2,3,4,5].map(num => `
                                    <button class="rating-btn ${currentVote === num ? 'selected' : ''}" 
                                            onclick="setRating('${photo.id}', ${num})">${num}</button>
                                `).join('')}
                            </div>
                            <button class="save-btn" onclick="saveVote('${photo.id}')" 
                                    ${currentVote === 0 ? 'disabled' : ''}>
                                ${currentVote > 0 ? '‚úì Atualizar Voto' : 'Salvar Voto'}
                            </button>
                            ${currentVote > 0 ? `<p style="text-align: center; margin-top: 10px; color: #4CAF50;">Nota atual: ${currentVote}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="photo-container">
                        <img src="${photo.link}" alt="${photo.titulo}" 
                             onclick="openModal('${photo.link}', '${photo.titulo}')" 
                             onerror="this.src='https://via.placeholder.com/400x300/cccccc/666666?text=Foto+Indispon√≠vel'">
                        <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                            Clique na foto para ampliar
                        </p>
                    </div>
                </div>
            `;
            
            updateProgress();
            updateNavigation();
        }

        function setRating(photoId, rating) {
            votes[photoId] = rating;
            
            // Atualizar visual dos bot√µes
            document.querySelectorAll('.rating-btn').forEach((btn, index) => {
                btn.classList.toggle('selected', index + 1 === rating);
            });
            
            // Habilitar bot√£o de salvar
            document.querySelector('.save-btn').disabled = false;
        }

        async function saveVote(photoId) {
            const rating = votes[photoId];
            if (!rating) return;
            
            try {
                // Encontrar linha da foto
                const photoIndex = photos.findIndex(p => p.id === photoId);
                const rowNumber = photoIndex + 2; // +2 porque come√ßa na linha 2 do Sheets
                const coluna = currentUser.juradoInfo.coluna;
                
                showSaveStatus('Salvando...');
                
                await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SHEET_ID,
                    range: `Fotos_Votacao!${coluna}${rowNumber}`,
                    valueInputOption: 'RAW',
                    resource: {
                        values: [[rating]]
                    }
                });
                
                // Atualizar m√©dia se necess√°rio
                await updateMedia(rowNumber);
                
                showSaveStatus('‚úì Salvo!', 'success');
                
                setTimeout(() => {
                    hideSaveStatus();
                    // Auto-navegar para pr√≥xima foto n√£o votada
                    navigateToNextUnvoted();
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao salvar voto:', error);
                showSaveStatus('Erro ao salvar', 'error');
            }
        }

        async function updateMedia(rowNumber) {
            // F√≥rmula para calcular m√©dia dos 4 jurados
            const formula = `=SE(CONTAR.VALORES(F${rowNumber}:I${rowNumber})>0;M√âDIA(F${rowNumber}:I${rowNumber});"")`;
            
            await gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SHEET_ID,
                range: `Fotos_Votacao!J${rowNumber}`,
                valueInputOption: 'USER_ENTERED',
                resource: {
                    values: [[formula]]
                }
            });
        }

        function showSaveStatus(message, type = 'info') {
            const statusEl = document.querySelector('.save-status') || createSaveStatus();
            statusEl.textContent = message;
            statusEl.className = `save-status ${type}`;
            statusEl.style.display = 'block';
        }

        function hideSaveStatus() {
            const statusEl = document.querySelector('.save-status');
            if (statusEl) statusEl.style.display = 'none';
        }

        function createSaveStatus() {
            const statusEl = document.createElement('div');
            statusEl.className = 'save-status';
            statusEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                border-radius: 8px;
                font-weight: bold;
                z-index: 1000;
                display: none;
            `;
            document.body.appendChild(statusEl);
            return statusEl;
        }

        function navigatePhoto(direction) {
            const newIndex = currentPhotoIndex + direction;
            if (newIndex >= 0 && newIndex < photos.length) {
                currentPhotoIndex = newIndex;
                loadCurrentPhoto();
            }
        }

        function navigateToNextUnvoted() {
            for (let i = currentPhotoIndex + 1; i < photos.length; i++) {
                if (!votes[photos[i].id]) {
                    currentPhotoIndex = i;
                    loadCurrentPhoto();
                    return;
                }
            }
            
            // Se chegou aqui, todas foram votadas
            showSummary();
        }

        function updateProgress() {
            const votedCount = Object.keys(votes).length;
            const progress = (votedCount / photos.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateNavigation() {
            const counter = document.getElementById('photoCounter');
            counter.textContent = `${currentPhotoIndex + 1} / ${photos.length}`;
            
            document.getElementById('prevBtn').disabled = currentPhotoIndex === 0;
            document.getElementById('nextBtn').disabled = currentPhotoIndex === photos.length - 1;
        }

        function showSummary() {
            const votedCount = Object.keys(votes).length;
            const avgRating = Object.values(votes).reduce((a, b) => a + b, 0) / votedCount;
            
            document.getElementById('summaryStats').innerHTML = `
                <p><strong>Fotos avaliadas:</strong> ${votedCount} de ${photos.length}</p>
                <p><strong>Nota m√©dia dada:</strong> ${avgRating.toFixed(1)}</p>
            `;
            
            document.getElementById('summary').style.display = 'block';
        }

        function openModal(src, title) {
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = src;
            modalImg.alt = title;
        }

        function closeModal() {
            document.getElementById('photoModal').style.display = 'none';
        }

        function logout() {
            currentUser = null;
            votes = {};
            currentPhotoIndex = 0;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('votingInterface').style.display = 'none';
        }

        // Converter link do Drive para visualiza√ß√£o direta
        function convertDriveLink(driveUrl) {
            if (!driveUrl) return '';
            
            // Extrair ID do arquivo do Drive
            const fileIdMatch = driveUrl.match(/\/d\/([a-zA-Z0-9-_]+)/) || 
                               driveUrl.match(/id=([a-zA-Z0-9-_]+)/);
            
            if (fileIdMatch) {
                return `https://drive.google.com/uc?id=${fileIdMatch[1]}`;
            }
            
            return driveUrl;
        }

        function logout() {
            if (gapiInitialized) {
                const authInstance = gapi.auth2.getAuthInstance();
                authInstance.signOut();
            }
            
            currentUser = null;
            votes = {};
            currentPhotoIndex = 0;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('loginSection').innerHTML = `
                <h2>Acesso para Jurados</h2>
                <p style="margin: 20px 0;">Entre com sua conta Google para come√ßar a vota√ß√£o</p>
                <button id="loginBtn" class="login-btn">
                    <span>üìß</span>
                    Entrar com Google
                </button>
            `;
            document.getElementById('votingInterface').style.display = 'none';
            
            // Reconfigurar event listener
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
        }

        // Teclas de atalho
        document.addEventListener('keydown', function(e) {
            if (currentUser) {
                if (e.key >= '1' && e.key <= '5') {
                    const photo = photos[currentPhotoIndex];
                    setRating(photo.id, parseInt(e.key));
                } else if (e.key === 'ArrowLeft') {
                    navigatePhoto(-1);
                } else if (e.key === 'ArrowRight') {
                    navigatePhoto(1);
                } else if (e.key === 'Enter') {
                    const photo = photos[currentPhotoIndex];
                    if (votes[photo.id]) saveVote(photo.id);
                }
            }
        });
    </script>
</body>
</html>
